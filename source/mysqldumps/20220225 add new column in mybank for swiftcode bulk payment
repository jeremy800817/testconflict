ALTER TABLE `mybank` ADD COLUMN `bnk_swiftcode` varchar(32) NOT NULL COMMENT 'bank swiftcode from bulkpaymenttemplate' AFTER `bnk_code`


CREATE OR REPLACE VIEW `vw_mydisbursement`  AS  
select `mydisbursement`.`dbm_id` AS `dbm_id`,`mydisbursement`.`dbm_amount` AS `dbm_amount`,`mydisbursement`.`dbm_refno` AS `dbm_refno`,`mydisbursement`.`dbm_verifiedamount` AS `dbm_verifiedamount`,`mydisbursement`.`dbm_gatewayrefno` AS `dbm_gatewayrefno`,`mydisbursement`.`dbm_transactionrefno` AS `dbm_transactionrefno`,`mydisbursement`.`dbm_bankid` AS `dbm_bankid`,`mydisbursement`.`dbm_bankrefno` AS `dbm_bankrefno`,`mydisbursement`.`dbm_accountname` AS `dbm_accountname`,`mydisbursement`.`dbm_accountnumber` AS `dbm_accountnumber`,`mydisbursement`.`dbm_acebankcode` AS `dbm_acebankcode`,`mydisbursement`.`dbm_fee` AS `dbm_fee`,`mydisbursement`.`dbm_accountholderid` AS `dbm_accountholderid`,`mydisbursement`.`dbm_status` AS `dbm_status`,`mydisbursement`.`dbm_requestedon` AS `dbm_requestedon`,`mydisbursement`.`dbm_disbursedon` AS `dbm_disbursedon`,`mydisbursement`.`dbm_cancelledon` AS `dbm_cancelledon`,`mydisbursement`.`dbm_createdon` AS `dbm_createdon`,`mydisbursement`.`dbm_createdby` AS `dbm_createdby`,`mydisbursement`.`dbm_modifiedon` AS `dbm_modifiedon`,`mydisbursement`.`dbm_modifiedby` AS `dbm_modifiedby`,`myaccountholder`.`ach_fullname` AS `dbm_accountholdername`,`myaccountholder`.`ach_accountholdercode` AS `dbm_accountholdercode`,`createdby`.`usr_name` AS `dbm_createdbyname`,`modifiedby`.`usr_name` AS `dbm_modifiedbyname`,
`mybank`.`bnk_swiftcode` AS `dbm_bankswiftcode`
 from ((((`mydisbursement` left join `myaccountholder` on((`myaccountholder`.`ach_id` = `mydisbursement`.`dbm_accountholderid`))) left join `mybank` on((`mybank`.`bnk_id` = `mydisbursement`.`dbm_bankid`))) left join `user` `createdby` on((`createdby`.`usr_id` = `mydisbursement`.`dbm_createdby`))) left join `user` `modifiedby` on((`modifiedby`.`usr_id` = `mydisbursement`.`dbm_modifiedby`))) ;


CREATE OR REPLACE VIEW `vw_mygoldtransaction` AS  
select `gtr`.`gtr_id` AS `gtr_id`,`gtr`.`gtr_originalamount` AS `gtr_originalamount`,`gtr`.`gtr_settlementmethod` AS `gtr_settlementmethod`,`gtr`.`gtr_salespersoncode` AS `gtr_salespersoncode`,`gtr`.`gtr_campaigncode` AS `gtr_campaigncode`,`gtr`.`gtr_refno` AS `gtr_refno`,`gtr`.`gtr_orderid` AS `gtr_orderid`,`gtr`.`gtr_status` AS `gtr_status`,`gtr`.`gtr_rewardstatus` AS `gtr_rewardstatus`,`gtr`.`gtr_completedon` AS `gtr_completedon`,`gtr`.`gtr_reversedon` AS `gtr_reversedon`,`gtr`.`gtr_failedon` AS `gtr_failedon`,`gtr`.`gtr_createdon` AS `gtr_createdon`,`gtr`.`gtr_createdby` AS `gtr_createdby`,`gtr`.`gtr_modifiedon` AS `gtr_modifiedon`,`gtr`.`gtr_modifiedby` AS `gtr_modifiedby`,(case when (`order`.`ord_type` = 'CompanyBuy') then `vw_mydisbursement`.`dbm_gatewayrefno` when (`order`.`ord_type` = 'CompanySell') then `vw_mypaymentdetail`.`pdt_gatewayrefno` else `vw_mypaymentdetail`.`pdt_gatewayrefno` end) AS `gtr_dbmpdtgatewayrefno`,(case when (`order`.`ord_type` = 'CompanyBuy') then `vw_mydisbursement`.`dbm_refno` when (`order`.`ord_type` = 'CompanySell') then `vw_mypaymentdetail`.`pdt_paymentrefno` else `vw_mypaymentdetail`.`pdt_paymentrefno` end) AS `gtr_dbmpdtreferenceno`,(case when (`order`.`ord_type` = 'CompanyBuy') then `vw_mydisbursement`.`dbm_requestedon` when (`order`.`ord_type` = 'CompanySell') then `vw_mypaymentdetail`.`pdt_requestedon` else `vw_mypaymentdetail`.`pdt_requestedon` end) AS `gtr_dbmpdtrequestedon`,(case when (`order`.`ord_type` = 'CompanyBuy') then `vw_mydisbursement`.`dbm_accountholdername` when (`order`.`ord_type` = 'CompanySell') then `vw_mypaymentdetail`.`pdt_accountholdername` else `vw_mypaymentdetail`.`pdt_accountholdername` end) AS `gtr_dbmpdtaccountholdername`,(case when (`order`.`ord_type` = 'CompanyBuy') then `vw_mydisbursement`.`dbm_accountholdercode` when (`order`.`ord_type` = 'CompanySell') then `vw_mypaymentdetail`.`pdt_accountholdercode` else `vw_mypaymentdetail`.`pdt_accountholdercode` end) AS `gtr_dbmpdtaccountholdercode`,(case when (`order`.`ord_type` = 'CompanyBuy') then `vw_mydisbursement`.`dbm_verifiedamount` when (`order`.`ord_type` = 'CompanySell') then `vw_mypaymentdetail`.`pdt_verifiedamount` else `vw_mypaymentdetail`.`pdt_verifiedamount` end) AS `gtr_dbmpdtverifiedamount`,`order`.`ord_partnerid` AS `gtr_ordpartnerid`,`order`.`ord_buyerid` AS `gtr_ordbuyerid`,`order`.`ord_orderno` AS `gtr_ordorderno`,`order`.`ord_type` AS `gtr_ordtype`,`order`.`ord_price` AS `gtr_ordprice`,`order`.`ord_xau` AS `gtr_ordxau`,`order`.`ord_amount` AS `gtr_ordamount`,(case when ((`gtr`.`gtr_status` = 1) or (`gtr`.`gtr_status` = 2)) then `order`.`ord_fee` else 0 end) AS `gtr_ordfee`,`order`.`ord_remarks` AS `gtr_ordremarks`,`order`.`ord_isspot` AS `gtr_ordisspot`,`order`.`ord_bookingon` AS `gtr_ordbookingon`,`order`.`ord_confirmon` AS `gtr_ordconfirmon`,`order`.`ord_cancelon` AS `gtr_ordcancelon`,`order`.`ord_status` AS `gtr_ordstatus`,`myaccountholder`.`ach_fullname` AS `gtr_achfullname`,`myaccountholder`.`ach_accountholdercode` AS `gtr_achcode`,`myaccountholder`.`ach_email` AS `gtr_achemail`,`myaccountholder`.`ach_mykadno` AS `gtr_achmykadno`,`myaccountholder`.`ach_phoneno` AS `gtr_achphoneno`,`myaccountholder`.`ach_partnercusid` AS `gtr_achpartnercusid`,`myaccountholder`.`ach_type` AS `gtr_achtype`,(case when (`myaccountholder`.`ach_type` = 1) then 'Premium' else 'Basic' end) AS `gtr_achtypename`,`partner`.`par_name` AS `gtr_ordpartnername`,`product`.`pdt_name` AS `gtr_ordproductname`,`vw_mypaymentdetail`.`pdt_amount` AS `gtr_pdtamount`,`vw_mypaymentdetail`.`pdt_sourcerefno` AS `gtr_pdtsourcerefno`,`vw_mypaymentdetail`.`pdt_signeddata` AS `gtr_pdtsigneddata`,`vw_mypaymentdetail`.`pdt_location` AS `gtr_pdtlocation`,`vw_mypaymentdetail`.`pdt_gatewayfee` AS `gtr_pdtgatewayfee`,`vw_mypaymentdetail`.`pdt_customerfee` AS `gtr_pdtcustomerfee`,`vw_mypaymentdetail`.`pdt_token` AS `gtr_pdttoken`,`vw_mypaymentdetail`.`pdt_status` AS `gtr_pdtstatus`,`vw_mypaymentdetail`.`pdt_transactiondate` AS `gtr_pdttransactiondate`,`vw_mypaymentdetail`.`pdt_successon` AS `gtr_pdtsuccesson`,`vw_mypaymentdetail`.`pdt_failedon` AS `gtr_pdtfailedon`,`vw_mypaymentdetail`.`pdt_refundedon` AS `gtr_pdtrefundedon`,`vw_mydisbursement`.`dbm_amount` AS `gtr_dbmamount`,`vw_mydisbursement`.`dbm_bankid` AS `gtr_dbmbankid`,`vw_mydisbursement`.`dbm_bankswiftcode` AS `gtr_dbmbankswiftcode`,`vw_mydisbursement`.`dbm_bankrefno` AS `gtr_dbmbankrefno`,`vw_mydisbursement`.`dbm_accountname` AS `gtr_dbmaccountname`,`vw_mydisbursement`.`dbm_accountnumber` AS `gtr_dbmaccountnumber`,`vw_mydisbursement`.`dbm_acebankcode` AS `gtr_dbmacebankcode`,`vw_mydisbursement`.`dbm_fee` AS `gtr_dbmfee`,`vw_mydisbursement`.`dbm_status` AS `gtr_dbmstatus`,`vw_mydisbursement`.`dbm_transactionrefno` AS `gtr_dbmtransactionrefno`,`vw_mydisbursement`.`dbm_disbursedon` AS `gtr_dbmdisbursedon`,`mybank`.`bnk_name` AS `gtr_dbmbankname`
from (((((((`mygoldtransaction` `gtr` left join `order` on((`gtr`.`gtr_orderid` = `order`.`ord_id`))) left join `product` on((`order`.`ord_productid` = `product`.`pdt_id`))) left join `myaccountholder` on((`myaccountholder`.`ach_id` = `order`.`ord_buyerid`))) left join `vw_mypaymentdetail` on((`gtr`.`gtr_refno` = `vw_mypaymentdetail`.`pdt_sourcerefno`))) left join `vw_mydisbursement` on((`gtr`.`gtr_refno` = `vw_mydisbursement`.`dbm_transactionrefno`))) left join `mybank` on((`mybank`.`bnk_id` = `vw_mydisbursement`.`dbm_bankid`))) left join `partner` on((`partner`.`par_id` = `order`.`ord_partnerid`))) ;

